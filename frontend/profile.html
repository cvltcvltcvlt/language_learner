<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ—Ñ—ñ–ª—å ‚Äî Language Learner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* === –ó–∞–≥–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ === */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      height: 100vh;
      background: linear-gradient(270deg, #6a11cb, #2575fc, #6a11cb);
      background-size: 600% 600%;
      animation: gradientMove 15s ease infinite;
      overflow-x: hidden;
      color: white;
      position: relative;
    }

    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .background-image {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url('https://i.pinimg.com/originals/b1/58/74/b158741d3532cf61bdead1bd9e2e87f7.png') no-repeat center center;
      background-size: cover;
      filter: blur(8px) brightness(0.7);
      z-index: -1;
    }

    .navbar {
      width: 100%;
      display: flex;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 20px;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .nav-item {
      margin: 0 15px;
      font-weight: bold;
      font-size: 18px;
      color: #ffffff;
      text-decoration: none;
      padding: 10px 20px;
      border: 2px solid transparent;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-item:hover {
      background: #2575fc;
      border-color: #2575fc;
      color: white;
      transform: scale(1.05);
    }

    .content {
      margin-top: 120px;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .profile-box {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 40px;
      border-radius: 20px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      color: #333;
      animation: fadeInUp 1s ease forwards;
      text-align: center;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      margin-bottom: 20px;
      font-size: 28px;
      color: #333;
    }

    p {
      font-size: 18px;
      margin-bottom: 10px;
    }

    .btn {
      margin-top: 20px;
      padding: 12px 25px;
      font-size: 18px;
      font-weight: bold;
      color: #2575fc;
      background: transparent;
      border: 2px solid #2575fc;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: #2575fc;
      color: white;
      transform: scale(1.05);
    }

    .progress-container {
      width: 100%;
      background: #e9ecef;
      height: 12px;
      border-radius: 6px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: #2575fc;
      width: 0%;
      transition: width 0.5s ease-in-out;
    }

    .medal {
      margin-top: 20px;
      font-size: 24px;
    }

    #top-users-list {
      margin-top: 30px;
      text-align: left;
    }

    .user-card {
      display: flex;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 10px;
      padding: 10px 15px;
      margin-bottom: 10px;
      font-size: 16px;
      color: #333;
    }

    .error {
      color: red;
      font-weight: bold;
      margin-top: 15px;
    }
  </style>
</head>

<body>

<div class="background-image"></div>

<!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
<div class="navbar">
  <a href="profile.html" class="nav-item">–ü—Ä–æ—Ñ—ñ–ª—å üë§</a>
  <a href="lesson.html" class="nav-item">–£—Ä–æ–∫–∏ üìñ</a>
  <a href="test.html" class="nav-item">–¢–µ—Å—Ç–∏ üìù</a>
  <a href="#" class="nav-item" onclick="logout()">–í–∏–π—Ç–∏ üö™</a>
</div>

<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
<div class="content">
  <div class="profile-box">
    <h1>–ü—Ä–æ—Ñ—ñ–ª—å</h1>
    <div id="profile-info">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    <div class="progress-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="medal" id="medal"></div>

    <h2 style="margin-top: 30px;">üèÜ –¢–æ–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
    <div id="top-users-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

    <button class="btn" onclick="backDashboard()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
    <div id="error-message" class="error"></div>
  </div>
</div>

<script>
const API_URL = 'http://127.0.0.1:8080';

if (!localStorage.getItem('token')) {
  window.location.href = 'login.html';
}

async function loadProfile() {
  const userId = localStorage.getItem('userId');

  try {
    const res = await fetch(`${API_URL}/profile/${userId}`, {
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    });

    if (!res.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é.');

    const data = await res.json();

    const container = document.getElementById('profile-info');
    container.innerHTML = `
      <p><strong>–õ–æ–≥—ñ–Ω:</strong> ${data.login}</p>
      <p><strong>Email:</strong> ${data.email || 'N/A'}</p>
      <p><strong>–†—ñ–≤–µ–Ω—å –º–æ–≤–∏:</strong> ${data.language_level}</p>
      <p><strong>–î–æ—Å–≤—ñ–¥:</strong> ${data.experience} XP</p>
    `;

    updateProgress(data.experience);
    showMedal(data.experience);

  } catch (error) {
    document.getElementById('error-message').textContent = error.message;
  }
}

function updateProgress(xp) {
  const percent = Math.min((xp / 1000) * 100, 100);
  document.getElementById('progress-bar').style.width = `${percent}%`;
}

function showMedal(xp) {
  const medalEl = document.getElementById('medal');
  if (xp >= 800) {
    medalEl.innerHTML = 'ü•á –ó–æ–ª–æ—Ç–∞ –º–µ–¥–∞–ª—å!';
  } else if (xp >= 500) {
    medalEl.innerHTML = 'ü•à –°—Ä—ñ–±–Ω–∞ –º–µ–¥–∞–ª—å!';
  } else if (xp >= 200) {
    medalEl.innerHTML = 'ü•â –ë—Ä–æ–Ω–∑–æ–≤–∞ –º–µ–¥–∞–ª—å!';
  } else {
    medalEl.innerHTML = 'üéñÔ∏è –ù–æ–≤–∞—á–æ–∫';
  }
}

async function loadTopUsers() {
  try {
    const res = await fetch(`${API_URL}/top_users`);
    const users = await res.json();

    const container = document.getElementById('top-users-list');
    container.innerHTML = '';

    users.slice(0, 10).forEach((user, index) => {
      let medal = '';
      if (index === 0) medal = 'ü•á';
      else if (index === 1) medal = 'ü•à';
      else if (index === 2) medal = 'ü•â';

      container.innerHTML += `
        <div class="user-card">
          <span>${medal} ${user.login}</span>
          <span>${user.experience} XP</span>
        </div>
      `;
    });

    if (!users.length) {
      container.innerHTML = '<p>–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Ç–æ–ø—ñ.</p>';
    }

  } catch (error) {
    document.getElementById('top-users-list').innerText = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–ø—É.';
  }
}

function logout() {
  localStorage.clear();
  window.location.href = 'login.html';
}

function backDashboard() {
  window.location.href = 'dashboard.html';
}

document.addEventListener('DOMContentLoaded', () => {
  loadProfile();
  loadTopUsers();
});
</script>

</body>
</html>
